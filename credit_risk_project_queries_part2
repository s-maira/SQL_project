# Analysis 4 : Are there any factors in the application table affecting the Payment Difficulties?

#TO ANALYZE IF THE OCCUPATION TYPE HAS AFFECTED THEIR PAYMENT DIFFICULTIES

SELECT TARGET, 
	COUNT(TARGET) AS NUM_OF_CLIENTS, 
	OCCUPATION_TYPE 
FROM application
GROUP BY TARGET, OCCUPATION_TYPE
ORDER BY 
	OCCUPATION_TYPE ASC,
	NUM_OF_CLIENTS DESC
	
  
#TO ANALYZE IF HAVING REALTY AN CARS AFFECTS THE CLIENTS' PAYMENT DIFFICULTIES

SELECT FLAG_OWN_REALTY, TARGET, COUNT(TARGET) AS NUM_OF_CLIENT 
FROM application
GROUP BY TARGET, FLAG_OWN_REALTY 
ORDER BY
	FLAG_OWN_REALTY DESC,
	NUM_OF_CLIENT DESC
	
SELECT FLAG_OWN_CAR, TARGET, COUNT(TARGET) AS NUM_OF_CLIENT
FROM application
GROUP BY TARGET, FLAG_OWN_CAR 
ORDER BY 
	FLAG_OWN_CAR DESC,
	NUM_OF_CLIENT DESC

	
#TO ANALYZE IF THE AMT_INCOME AFFECTS THE CLIENTS' PAYMENT DIFFICULTIES
	
SELECT
CASE
	WHEN AMT_INCOME_TOTAL <= 50000 THEN "50K AND BELOW"
	WHEN AMT_INCOME_TOTAL > 50000 and AMT_INCOME_TOTAL <= 100000 THEN "50K TO 100K"
	WHEN AMT_INCOME_TOTAL > 100000 and AMT_INCOME_TOTAL <= 150000 THEN "100K TO 150K"
	WHEN AMT_INCOME_TOTAL > 150000 and AMT_INCOME_TOTAL <= 200000 THEN "150K TO 200K"
	WHEN AMT_INCOME_TOTAL > 200000 AND AMT_INCOME_TOTAL <= 250000 THEN "200K TO 250K"
	WHEN AMT_INCOME_TOTAL > 250000 AND AMT_INCOME_TOTAL <= 300000 THEN "250K TO 300K"
	WHEN AMT_INCOME_TOTAL > 300000 AND AMT_INCOME_TOTAL <= 350000 THEN "300K TO 350K"
	WHEN AMT_INCOME_TOTAL > 350000 AND AMT_INCOME_TOTAL <= 400000 THEN "350K TO 400K"
	WHEN AMT_INCOME_TOTAL > 400000 AND AMT_INCOME_TOTAL <= 450000 THEN "400K TO 450K"
	WHEN AMT_INCOME_TOTAL > 450000 AND AMT_INCOME_TOTAL <= 500000 THEN "450K TO 500K"
	WHEN AMT_INCOME_TOTAL > 500000 THEN "MORE THAN 500K"
END AS "INCOME_CLASS",
	TARGET, 
	COUNT(TARGET) AS "NUM_OF_CLIENT"
FROM application
GROUP BY INCOME_CLASS, TARGET
ORDER BY INCOME_CLASS


# TO ANALYZE IF THE INCOME_TYPE HAS SIGNIFICANT EFFECT ON PAYMENT DIFFICULTIES.

SELECT 
	NAME_INCOME_TYPE, 
	TARGET, 
	COUNT(TARGET) AS 'NUM_OF_CLIENTS'
FROM application
GROUP BY 
	NAME_INCOME_TYPE, TARGET 
ORDER BY 
	NAME_INCOME_TYPE ASC, NUM_OF_CLIENTS DESC  

SELECT NAME_INCOME_TYPE, TARGET 
FROM application
WHERE NAME_INCOME_TYPE = 'Maternity Leave'


# TO ANALYZE IF THE EDUCATION_TYPE HAS SIGNIFICANT EFFECT ON PAYMENT_DIFFICULTIES

SELECT 
	NAME_EDUCATION_TYPE, 
	TARGET, 
	COUNT(TARGET) AS 'NUM_OF_CLIENTS'
FROM application
GROUP BY 
	NAME_EDUCATION_TYPE, TARGET 
ORDER BY 
	NAME_EDUCATION_TYPE, 
	NUM_OF_CLIENTS DESC

# Analysis 5 : Are there any factors in the application table affecting the Payment Difficulties?

#TO ANALYZE IF THE OCCUPATION TYPE HAS AFFECTED THEIR PAYMENT DIFFICULTIES

SELECT TARGET, 
	COUNT(TARGET) AS NUM_OF_CLIENTS, 
	OCCUPATION_TYPE 
FROM application
GROUP BY TARGET, OCCUPATION_TYPE
ORDER BY 
	OCCUPATION_TYPE ASC,
	NUM_OF_CLIENTS DESC
	
	
#TO ANALYZE IF THE NUMBER OF CHILDREN HAS SIGNIFICANT AFFECT ON THE CLIENTS' PAYMENT DIFFICULTIES

SELECT TARGET, 
	CNT_CHILDREN, 
	COUNT(CNT_CHILDREN) AS NUM_OF_CLIENT
FROM application
GROUP BY TARGET, CNT_CHILDREN
ORDER BY 
	CNT_CHILDREN ASC,
	NUM_OF_CLIENT DESC
	
	
#TO ANALYZE IF HAVING REALTY AN CARS AFFECTS THE CLIENTS' PAYMENT DIFFICULTIES

SELECT FLAG_OWN_REALTY, TARGET, COUNT(TARGET) AS NUM_OF_CLIENT 
FROM application
GROUP BY TARGET, FLAG_OWN_REALTY 
ORDER BY
	FLAG_OWN_REALTY DESC,
	NUM_OF_CLIENT DESC
	
SELECT FLAG_OWN_CAR, TARGET, COUNT(TARGET) AS NUM_OF_CLIENT
FROM application
GROUP BY TARGET, FLAG_OWN_CAR 
ORDER BY 
	FLAG_OWN_CAR DESC,
	NUM_OF_CLIENT DESC

	
#TO ANALYZE IF THE AMT_INCOME AFFECTS THE CLIENTS' PAYMENT DIFFICULTIES
	
SELECT
CASE
	WHEN AMT_INCOME_TOTAL <= 50000 THEN "50K AND BELOW"
	WHEN AMT_INCOME_TOTAL > 50000 and AMT_INCOME_TOTAL <= 100000 THEN "50K TO 100K"
	WHEN AMT_INCOME_TOTAL > 100000 and AMT_INCOME_TOTAL <= 150000 THEN "100K TO 150K"
	WHEN AMT_INCOME_TOTAL > 150000 and AMT_INCOME_TOTAL <= 200000 THEN "150K TO 200K"
	WHEN AMT_INCOME_TOTAL > 200000 AND AMT_INCOME_TOTAL <= 250000 THEN "200K TO 250K"
	WHEN AMT_INCOME_TOTAL > 250000 AND AMT_INCOME_TOTAL <= 300000 THEN "250K TO 300K"
	WHEN AMT_INCOME_TOTAL > 300000 AND AMT_INCOME_TOTAL <= 350000 THEN "300K TO 350K"
	WHEN AMT_INCOME_TOTAL > 350000 AND AMT_INCOME_TOTAL <= 400000 THEN "350K TO 400K"
	WHEN AMT_INCOME_TOTAL > 400000 AND AMT_INCOME_TOTAL <= 450000 THEN "400K TO 450K"
	WHEN AMT_INCOME_TOTAL > 450000 AND AMT_INCOME_TOTAL <= 500000 THEN "450K TO 500K"
	WHEN AMT_INCOME_TOTAL > 500000 THEN "MORE THAN 500K"
END AS "INCOME_CLASS",
	TARGET, 
	COUNT(TARGET) AS "NUM_OF_CLIENT"
FROM application
GROUP BY INCOME_CLASS, TARGET
ORDER BY INCOME_CLASS

# TO ANALYZE IF THE INCOME_TYPE HAS SIGNIFICANT EFFECT ON PAYMENT DIFFICULTIES.

SELECT 
	NAME_INCOME_TYPE, 
	TARGET, 
	COUNT(TARGET) AS 'NUM_OF_CLIENTS'
FROM application
GROUP BY 
	NAME_INCOME_TYPE, TARGET 
ORDER BY 
	NAME_INCOME_TYPE ASC, NUM_OF_CLIENTS DESC  

SELECT NAME_INCOME_TYPE, TARGET 
FROM application
WHERE NAME_INCOME_TYPE = 'Maternity Leave'


# TO ANALYZE IF THE EDUCATION_TYPE HAS SIGNIFICANT EFFECT ON PAYMENT_DIFFICULTIES

SELECT 
	NAME_EDUCATION_TYPE, 
	TARGET, 
	COUNT(TARGET) AS 'NUM_OF_CLIENTS'
FROM application
GROUP BY 
	NAME_EDUCATION_TYPE, TARGET 
ORDER BY 
	NAME_EDUCATION_TYPE, 
	NUM_OF_CLIENTS DESC

  
# Analysis 5 : Is the number of other loans affecting the payment difficulties?
●	You will need to count the number of loans for each SK_ID_CURR in the “bureau” table.
●	Transform the counts into count groups (Discretization).
●	Compute the relation between average other loan count to the TARGET 

# To count the number of loans for each SK_ID_CURR

SELECT 
  SK_ID_CURR, 
  COUNT(SK_ID_CURR) AS "NUM_OF_LOAN"
FROM bureau
GROUP BY SK_ID_CURR

# TO ANALYZE the relation between the loan count to the TARGET

WITH TEMP_TABLE AS (
  SELECT SK_ID_CURR, COUNT(SK_ID_CURR) AS "NUM_OF_LOAN"
  FROM bureau
  GROUP BY SK_ID_CURR 
  ORDER BY "NUM_OF_LOAN")

SELECT 
  TEMP_TABLE.NUM_OF_LOAN, 
  COUNT(TEMP_TABLE.SK_ID_CURR) AS "NUM_OF_CLIENT",
	application.TARGET
FROM TEMP_TABLE JOIN application ON TEMP_TABLE.SK_ID_CURR = application.SK_ID_CURR
GROUP BY NUM_OF_LOAN, TARGET
ORDER BY NUM_OF_LOAN

# DISCRETIZATION

WITH TEMP AS (SELECT SK_ID_CURR, COUNT(SK_ID_CURR) AS "NUM_OF_LOAN"
FROM bureau
GROUP BY SK_ID_CURR 
ORDER BY "NUM_OF_LOAN")

SELECT CASE 
	WHEN TEMP.NUM_OF_LOAN <= 10 THEN '10 OR LESS'
	WHEN TEMP.NUM_OF_LOAN > 10 AND TEMP.NUM_OF_LOAN <= 20 THEN '11-20'
	WHEN TEMP.NUM_OF_LOAN > 20 AND TEMP.NUM_OF_LOAN <= 30 THEN '21-30'
	WHEN TEMP.NUM_OF_LOAN > 30 AND TEMP.NUM_OF_LOAN <= 40 THEN '31-40'
	WHEN TEMP.NUM_OF_LOAN > 40 AND TEMP.NUM_OF_LOAN <= 50 THEN '41-50'
	WHEN TEMP.NUM_OF_LOAN > 50 THEN '50 OR MORE'
END AS "NUM_OF_LOANS",
COUNT(TEMP.SK_ID_CURR) AS "NUM_OF_CLIENT",
	application.TARGET
FROM TEMP JOIN application ON TEMP.SK_ID_CURR = application.SK_ID_CURR
GROUP BY NUM_OF_LOANS, TARGET
ORDER BY NUM_OF_LOANS






